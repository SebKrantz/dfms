<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to dfms • dfms</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to dfms">
<meta property="og:description" content="dfms">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dfms</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/SebKrantz/dfms/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to dfms</h1>
                        <h4 data-toc-skip class="author">Sebastian
Krantz</h4>
            
            <h4 data-toc-skip class="date">2023-04-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/SebKrantz/dfms/blob/HEAD/vignettes/introduction.Rmd" class="external-link"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="hidden name"><code>introduction.Rmd</code></div>

    </div>

    
    
<p><em>dfms</em> provides a user friendly and computationally efficient
approach to estimate linear Gaussian Dynamic Factor Models in R. The
package is not geared at any specific application, and can be used for
dimensionality reduction, forecasting and nowcasting systems of time
series. The use of the package is facilitated by a comprehensive set of
methods to explore/plot models and extract results.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sebkrantz.github.io/dfms/" class="external-link">dfms</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/joshuaulrich/xts" class="external-link">xts</a></span><span class="op">)</span></code></pre></div>
<p>This vignette walks through the main features of the package. The
data provided in the package in <em>xts</em> format is taken from
Banbura and Modugno (2014)<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>, henceforth BM14, and covers the Euro Area
from January 1980 through September 2009.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Using the monthly series from BM14</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">BM14_M</span><span class="op">)</span>
<span class="co">#&gt; [1] 357  92</span>
<span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html" class="external-link">index</a></span><span class="op">(</span><span class="va">BM14_M</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "1980-01-31" "2009-09-30"</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">BM14_M</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "ip_total"       "ip_tot_cstr"    "ip_tot_cstr_en" "ip_constr"     </span>
<span class="co">#&gt; [5] "ip_im_goods"    "ip_capital"</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">BM14_M</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
<p>The data frame <code>BM14_Models</code> provides information about
the series<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>, and the various models estimated by
BM14.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">BM14_Models</span>, <span class="fl">3</span><span class="op">)</span>
<span class="co">#&gt;           series</span>
<span class="co">#&gt; 1       ip_total</span>
<span class="co">#&gt; 2    ip_tot_cstr</span>
<span class="co">#&gt; 3 ip_tot_cstr_en</span>
<span class="co">#&gt;                                                                                           label</span>
<span class="co">#&gt; 1                                       IP-Total Industry - Working Day and Seasonally Adjusted</span>
<span class="co">#&gt; 2              IP-Total Industry (Excluding Construction) - Working Day and Seasonally Adjusted</span>
<span class="co">#&gt; 3 IP-Total Industry Excluding Construction and MIG Energy - Working Day and Seasonally Adjusted</span>
<span class="co">#&gt;                           code freq log_trans small medium large</span>
<span class="co">#&gt; 1 sts.m.i5.Y.PROD.NS0010.4.000    M      TRUE FALSE  FALSE  TRUE</span>
<span class="co">#&gt; 2 sts.m.i5.Y.PROD.NS0020.4.000    M      TRUE  TRUE   TRUE  TRUE</span>
<span class="co">#&gt; 3 sts.m.i5.Y.PROD.NS0021.4.000    M      TRUE FALSE  FALSE  TRUE</span>

<span class="co"># Using only monthly data</span>
<span class="va">BM14_Models_M</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">BM14_Models</span>, <span class="va">freq</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span></code></pre></div>
<p>Prior to estimation, all data is differenced by BM14, and some series
are log, differenced, as indicated by the <code>log_trans</code> column
in <code>BM14_Models</code>. In general, <em>dfms</em> uses a stationary
Kalman Filter with time-invariant system matrices, and therefore expects
data to be stationary. Data is also scaled and centered<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> in the main
<code><a href="../reference/DFM.html">DFM()</a></code> function, thus this does not need to be done by the
user.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span>
<span class="co"># log-transforming and first-differencing the data</span>
<span class="va">BM14_M</span><span class="op">[</span>, <span class="va">BM14_Models_M</span><span class="op">$</span><span class="va">log_trans</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">BM14_M_diff</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">BM14_M</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">BM14_M_diff</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
<div class="section level2">
<h2 id="determining-the-structure-of-the-model">Determining the Structure of the Model<a class="anchor" aria-label="anchor" href="#determining-the-structure-of-the-model"></a>
</h2>
<p>Before estimating a model, the <code><a href="../reference/ICr.html">ICr()</a></code> function can be
applied to determine the number of factors. It computes 3 information
criteria proposed in Bai and NG (2002)<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>, whereby the second
criteria generally suggests the most parsimonious model.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ic</span> <span class="op">=</span> <span class="fu"><a href="../reference/ICr.html">ICr</a></span><span class="op">(</span><span class="va">BM14_M_diff</span><span class="op">)</span>
<span class="co">#&gt; Missing values detected: imputing data with tsnarmimp() with default settings</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ic</span><span class="op">)</span>
<span class="co">#&gt; Optimal Number of Factors (r) from Bai and Ng (2002) Criteria</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; IC1 IC2 IC3 </span>
<span class="co">#&gt;   7   7  13</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ic</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<p>Another option is to use a Screeplot to gauge the number of factors
by looking for a kink in the plot. A mathematical procedure for finding
the kink was suggested by Onatski (2010)<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a>, but this is currently
not implemented in <code><a href="../reference/ICr.html">ICr()</a></code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/screeplot.html" class="external-link">screeplot</a></span><span class="op">(</span><span class="va">ic</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<p>Based on both the information criteria and the Screeplot, I gauge
that a model with 4 factors should be estimated, as factors, 5, 6 and 7
do not add much to the explanatory power of the model. Next to the
number of factors, the lag order of the factor-VAR of the transition
equation should be estimated (the default is 1 lag). This can be done
using the <code>VARselect()</code> function from the <em>vars</em>
package, with PCA factor estimates reported by <code><a href="../reference/ICr.html">ICr()</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Using vars::VARselect() with 4 principal components to estimate the VAR lag order</span>
<span class="fu">vars</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/vars/man/VARselect.html" class="external-link">VARselect</a></span><span class="op">(</span><span class="va">ic</span><span class="op">$</span><span class="va">F_pca</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; $selection</span>
<span class="co">#&gt; AIC(n)  HQ(n)  SC(n) FPE(n) </span>
<span class="co">#&gt;      6      3      3      6 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $criteria</span>
<span class="co">#&gt;                 1          2          3          4          5          6</span>
<span class="co">#&gt; AIC(n)   5.810223   5.617282   5.427760   5.389413   5.407765   5.381829</span>
<span class="co">#&gt; HQ(n)    5.898758   5.776646   5.657953   5.690434   5.779614   5.824507</span>
<span class="co">#&gt; SC(n)    6.032560   6.017490   6.005838   6.145361   6.341582   6.493517</span>
<span class="co">#&gt; FPE(n) 333.696100 275.153456 227.671078 219.144228 223.265640 217.639133</span>
<span class="co">#&gt;                 7          8          9         10</span>
<span class="co">#&gt; AIC(n)   5.409877   5.394900   5.421375   5.460761</span>
<span class="co">#&gt; HQ(n)    5.923383   5.979235   6.076538   6.186753</span>
<span class="co">#&gt; SC(n)    6.699434   6.862328   7.066673   7.283929</span>
<span class="co">#&gt; FPE(n) 223.956824 220.793226 226.933863 236.331677</span></code></pre></div>
<p>The selection thus suggests we should estimate a factor model with
<code>r = 4</code> factors and <code>p = 3</code> lags<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a>. Before estimating the
model I note that <em>dfms</em> does not deal with seasonality in
series, thus it is recommended to also seasonally adjust data,
e.g. using the <em>seasonal</em> package before estimation. BM14 only
use seasonally adjusted series, thus this is not necessary with the
example data provided.</p>
</div>
<div class="section level2">
<h2 id="estimation-and-exploration">Estimation and Exploration<a class="anchor" aria-label="anchor" href="#estimation-and-exploration"></a>
</h2>
<p>Estimation can then simply be done using the <code><a href="../reference/DFM.html">DFM()</a></code>
function with parameters <code>r</code> and <code>p</code><a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Estimating the model with 4 factors and 3 lags using BM14's EM algorithm</span>
<span class="va">model1</span> <span class="op">=</span> <span class="fu"><a href="../reference/DFM.html">DFM</a></span><span class="op">(</span><span class="va">BM14_M_diff</span>, r <span class="op">=</span> <span class="fl">4</span>, p <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="co">#&gt; Converged after 26 iterations.</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">model1</span><span class="op">)</span>
<span class="co">#&gt; Dynamic Factor Model: n = 92, T = 356, r = 4, p = 3, %NA = 25.8366</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Factor Transition Matrix [A]</span>
<span class="co">#&gt;      L1.f1   L1.f2   L1.f3   L1.f4   L2.f1   L2.f2   L2.f3   L2.f4   L3.f1</span>
<span class="co">#&gt; f1  0.4720 -0.1297  0.8460  0.2098 -0.0733 -0.1436 -0.0595  0.1565  0.2356</span>
<span class="co">#&gt; f2 -0.1612  0.1699  0.2389  0.1598  0.0641 -0.1341 -0.0542  0.1287  0.1336</span>
<span class="co">#&gt; f3  0.3965  0.3264  0.0213 -0.3033 -0.1542 -0.0467 -0.1484 -0.0150 -0.1172</span>
<span class="co">#&gt; f4  0.1096  0.1601 -0.1578  0.2485 -0.0365 -0.0563 -0.0230 -0.1117 -0.0719</span>
<span class="co">#&gt;      L3.f2   L3.f3   L3.f4</span>
<span class="co">#&gt; f1 -0.0803 -0.0386  0.0408</span>
<span class="co">#&gt; f2  0.1347 -0.0024 -0.0342</span>
<span class="co">#&gt; f3 -0.0087  0.1767  0.0249</span>
<span class="co">#&gt; f4  0.0307  0.0662 -0.0035</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model1</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<p>The model can be investigated using <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>, which
returns an object of class ‘dfm_summary’ containing the system matrices
and summary statistics of the factors and the residuals in the
measurement equation, as well as the R-Squared of the factor model for
individual series. The print method automatically adjusts the amount of
information printed to the data size. For large databases with more than
40 series, no series-level statistics are printed.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dfm_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">dfm_summary</span><span class="op">)</span> <span class="co"># Large model with &gt; 40 series: defaults to compact = 2</span>
<span class="co">#&gt; Dynamic Factor Model: n = 92, T = 356, r = 4, p = 3, %NA = 25.8366</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:  DFM(X = BM14_M_diff, r = 4, p = 3)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Summary Statistics of Factors [F]</span>
<span class="co">#&gt;       N     Mean   Median      SD       Min      Max</span>
<span class="co">#&gt; f1  356  -0.0448   0.3455  4.4505  -21.9265  11.0306</span>
<span class="co">#&gt; f2  356  -0.0319  -0.0892    2.68   -9.9549   7.4988</span>
<span class="co">#&gt; f3  356  -0.1032  -0.0593  3.2891  -12.0969  16.2455</span>
<span class="co">#&gt; f4  356  -0.0118    0.089   2.161   -8.2883  10.7219</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Factor Transition Matrix [A]</span>
<span class="co">#&gt;      L1.f1   L1.f2    L1.f3   L1.f4    L2.f1    L2.f2    L2.f3    L2.f4   L3.f1</span>
<span class="co">#&gt; f1  0.4720 -0.1297  0.84605  0.2098 -0.07334 -0.14356 -0.05950  0.15645  0.2356</span>
<span class="co">#&gt; f2 -0.1612  0.1699  0.23889  0.1598  0.06406 -0.13413 -0.05415  0.12869  0.1336</span>
<span class="co">#&gt; f3  0.3965  0.3264  0.02128 -0.3033 -0.15424 -0.04669 -0.14839 -0.01495 -0.1172</span>
<span class="co">#&gt; f4  0.1096  0.1601 -0.15776  0.2485 -0.03655 -0.05626 -0.02304 -0.11169 -0.0719</span>
<span class="co">#&gt;        L3.f2     L3.f3     L3.f4</span>
<span class="co">#&gt; f1 -0.080320 -0.038592  0.040812</span>
<span class="co">#&gt; f2  0.134692 -0.002391 -0.034215</span>
<span class="co">#&gt; f3 -0.008694  0.176663  0.024876</span>
<span class="co">#&gt; f4  0.030716  0.066201 -0.003465</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Factor Covariance Matrix [cov(F)]</span>
<span class="co">#&gt;           f1        f2        f3        f4</span>
<span class="co">#&gt; f1  19.8067    2.0846*  -3.4700*  -2.1094*</span>
<span class="co">#&gt; f2   2.0846*   7.1822   -2.8725*  -1.0631*</span>
<span class="co">#&gt; f3  -3.4700*  -2.8725*  10.8182    1.9286*</span>
<span class="co">#&gt; f4  -2.1094*  -1.0631*   1.9286*   4.6701 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Factor Transition Error Covariance Matrix [Q]</span>
<span class="co">#&gt;         u1      u2      u3      u4</span>
<span class="co">#&gt; u1  9.0178  0.3303 -3.0764 -1.0182</span>
<span class="co">#&gt; u2  0.3303  5.4425 -1.3095 -0.5051</span>
<span class="co">#&gt; u3 -3.0764 -1.3095  7.0230  0.8639</span>
<span class="co">#&gt; u4 -1.0182 -0.5051  0.8639  3.8005</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Summary of Residual AR(1) Serial Correlations</span>
<span class="co">#&gt;    N     Mean   Median      SD      Min     Max</span>
<span class="co">#&gt;   92  -0.0409  -0.0782  0.2959  -0.5073  0.6858</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Summary of Individual R-Squared's</span>
<span class="co">#&gt;    N    Mean  Median      SD     Min     Max</span>
<span class="co">#&gt;   92  0.3712   0.299  0.2888  0.0067  0.9978</span>

<span class="co"># Can request more detailed printouts</span>
<span class="co"># print(dfm_summary, compact = 1)</span>
<span class="co"># print(dfm_summary, compact = 0) </span></code></pre></div>
<p>Apart from the model summary, the <em>dfm</em> methods
<code><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals()</a></code> and <code><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted()</a></code> return observation
residuals and fitted values from the model. The default format is a
plain matrix, but the functions also have an argument to return data in
the original (input) format.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">resid</a></span><span class="op">(</span><span class="va">model1</span>, orig.format <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">model1</span>, orig.format <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-10-2.png" width="672"></p>
<p>Another way to examine the factor model visually is to plot the
Quasi-Maximum-Likelihood (QML) factor estimates against PCA and Two-Step
estimates following Doz, Giannone and Reichlin (2011)<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a>, where the Kalman
Filter and Smoother is run only once. Both estimates are also computed
by <code><a href="../reference/DFM.html">DFM()</a></code> during EM estimation and can also be visualized
with <code>plot.dfm</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model1</span>, method <span class="op">=</span> <span class="st">"all"</span>, type <span class="op">=</span> <span class="st">"individual"</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
<p>The plot with the various estimates shows that the QML estimates are
more volatile in the initial periods where there are many missing
series, but less volatile in the latter periods. In general, QML
estimates may now always be superior across the entire data range to
Two-Step and PCA estimates. Often, Two-Step estimates also provide
similar forecasting performance, and are much faster to estimate using
<code>DFM(BM14_M_diff, r = 4, p = 3, em.method = "none")</code>.</p>
<p>The factor estimates themselves can be extracted in a data frame
using <code><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame()</a></code>, which also provides various options
regarding the estimates retained and the format of the frame. It is also
possible to add a time variable from the original data (the default is a
sequence of integers).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Default: all estimates in long format</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">model1</span>, time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html" class="external-link">index</a></span><span class="op">(</span><span class="va">BM14_M_diff</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;   Method Factor       Time      Value</span>
<span class="co">#&gt; 1    PCA     f1 1980-02-29  1.1503013</span>
<span class="co">#&gt; 2    PCA     f1 1980-03-31  0.3374613</span>
<span class="co">#&gt; 3    PCA     f1 1980-04-30 -1.4905337</span>
<span class="co">#&gt; 4    PCA     f1 1980-05-31 -1.5360036</span>
<span class="co">#&gt; 5    PCA     f1 1980-06-30 -0.2828433</span>
<span class="co">#&gt; 6    PCA     f1 1980-07-31  0.3385403</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="forecasting">Forecasting<a class="anchor" aria-label="anchor" href="#forecasting"></a>
</h2>
<p>DFM forecasts can be obtained with the <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> method,
which dynamically forecasts the factors using the transition equation
(default 10 periods), and then also predicts data forecasts using the
observation equation. Objects are of class ‘dfm_forecast’</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 12-period ahead DFM forecast</span>
<span class="va">fc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model1</span>, h <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fc</span><span class="op">)</span>
<span class="co">#&gt; 12 Step Ahead Forecast from Dynamic Factor Model</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Factor Forecasts</span>
<span class="co">#&gt;        f1     f2      f3      f4</span>
<span class="co">#&gt; 1  3.4698 1.7276  0.2706 -0.9064</span>
<span class="co">#&gt; 2  2.4379 0.0305  1.3119 -0.0097</span>
<span class="co">#&gt; 3  1.6576 0.3182  0.7247  0.1037</span>
<span class="co">#&gt; 4  1.7445 0.7829 -0.2230 -0.1513</span>
<span class="co">#&gt; 5  0.8281 0.1390  0.5545  0.1199</span>
<span class="co">#&gt; 6  0.9576 0.3001  0.0126 -0.0923</span>
<span class="co">#&gt; 7  0.6599 0.2489  0.0333 -0.0518</span>
<span class="co">#&gt; 8  0.3354 0.0681  0.1999  0.0332</span>
<span class="co">#&gt; 9  0.4286 0.1824 -0.0830 -0.0672</span>
<span class="co">#&gt; 10 0.1853 0.0605  0.0882  0.0107</span>
<span class="co">#&gt; 11 0.1605 0.0544  0.0268 -0.0067</span>
<span class="co">#&gt; 12 0.1509 0.0734 -0.0288 -0.0235</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Series Forecasts</span>
<span class="co">#&gt;    ip_total ip_tot_cstr ip_tot_cstr_en ip_constr ip_im_goods ip_capital</span>
<span class="co">#&gt;    ip_d_cstr ip_nd_cons   ip_en ip_en_2 ip_manuf ip_metals ip_chemicals</span>
<span class="co">#&gt;    ip_electric ip_machinery ip_paper ip_plastic new_cars orders</span>
<span class="co">#&gt;    ret_turnover_defl ecs_ec_sent_ind ecs_ind_conf ecs_ind_order_book</span>
<span class="co">#&gt;    ecs_ind_stocks ecs_ind_prod_exp ecs_ind_prod_rec_m ecs_ind_x_orders</span>
<span class="co">#&gt;    ecs_ind_empl_exp ecs_cons_conf ecs_cons_sit_over_next_12 ecs_cons_exp_unempl</span>
<span class="co">#&gt;    ecs_cons_gen_last_12m ecs_cstr_conf ecs_cstr_order_books ecs_cstr_empl_exp</span>
<span class="co">#&gt;    ecs_cstr_prod_recent ecs_ret_tr_conf ecs_ret_tr_bus_sit ecs_ret_tr_stocks</span>
<span class="co">#&gt;    ecs_ret_tr_exp_bus ecs_ret_tr_empl ecs_serv_conf ecs_serv_empl_exp</span>
<span class="co">#&gt;    pms_comp_output pms_comp_empl pms_pmi pms_manuf_empl pms_manuf_output</span>
<span class="co">#&gt;    pms_manuf_product pms_serv_out pms_serv_empl pms_serv_new_bus</span>
<span class="co">#&gt;    pms_serv_product     urx empl_total empl_tot_xc empl_cstr empl_manuf</span>
<span class="co">#&gt;    extra_ea_trade_exp_val intra_ea_trade_exp_val extra_ea_trade_imp_val</span>
<span class="co">#&gt;    intra_ea_trade_imp_val  us_ip  us_urx us_empl us_retail_sales</span>
<span class="co">#&gt;    us_ip_manuf_exp us_cons_exp us_r3_m us_r10_year      m3   loans ir_long</span>
<span class="co">#&gt;    ir_short ir_1_year ir_2_year ir_5_year    eer eer_cpi eer_ppi exr_usd</span>
<span class="co">#&gt;    exr_gbp rxr_yen euro50 euro325  sp500  dow_j raw_mat_en raw_mat_oil</span>
<span class="co">#&gt;    raw_mat_gold raw_mat_oil_fwd raw_mat</span>
<span class="co">#&gt;  [ reached getOption("max.print") -- omitted 12 rows ]</span></code></pre></div>
<p>These forecasts can also be visualized using a plot method. By
default the entire series history is plotted along with the forecasts,
thus it is often helpful to restrict the plot range. As with any
stationary autoregressive model, the forecasts tend to zero quite
quickly<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Setting an appropriate plot range to see the forecast</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fc</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">320</span>, <span class="fl">370</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Predicting with Two-Step estimates</span>
<span class="co"># plot(predict(model1, h = 12, method = "2s"), xlim = c(320, 370))</span></code></pre></div>
<p>The forecasts can also be retrieved in data frame using
<code><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame()</a></code>. Again the method has various arguments to
control the forecasts retained (factors, data or both, default factors),
and the format of the frame.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Factor forecasts in wide format</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">fc</span>, pivot <span class="op">=</span> <span class="st">"wide"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;   Time Forecast         f1         f2         f3          f4</span>
<span class="co">#&gt; 1    1    FALSE   4.207651 -1.6552707  3.2190834 -1.82663141</span>
<span class="co">#&gt; 2    2    FALSE  -3.656458 -6.6178403 -3.9121446 -0.05762001</span>
<span class="co">#&gt; 3    3    FALSE -14.486337 -0.6573393 -6.8663850  1.69525122</span>
<span class="co">#&gt; 4    4    FALSE -14.794458  3.1573790 -6.4820328  1.70916785</span>
<span class="co">#&gt; 5    5    FALSE  -8.191696  0.5563773 -0.1840816  0.98407541</span>
<span class="co">#&gt; 6    6    FALSE  -1.357927 -0.3805697  3.5068964 -0.05346754</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="estimation-with-mixed-frequency">Estimation with Mixed Frequency<a class="anchor" aria-label="anchor" href="#estimation-with-mixed-frequency"></a>
</h2>
<p><em>dfms</em> currently provides no specific adjustments for data at
different frequencies. An algorithm that accommodates monthly and
quarterly series is planned for summer 2023. In the meantime, users may
choose to block the data (creating multiple quarterly series from a
monthly series, and duplicating quarterly series to maintain equal
representation).</p>
<!-- 
The baseline algorithm of BM14, being designed for arbitrary patterns of missing data, allows lower frequency series to be included in the estimation. The problem here is that series at lower frequency contain many missing values, which effectively lets these series have less weight in the estimation.

BM14 use the approximation of Mariano and Murasawa (2003) to construct a monthly equivalent for each quarterly series, with appropriate factor loadings in the estimation. 

In the absence of such adjustments to the algorithm, or other methods of interpolating quarterly data, a very simple way to increase the weight of these series in the estimation is to duplicate them in the dataset. Such duplication can be mechanical (e.g. duplicate quarterly series 2 times in monthly dataset), but should ideally be based on considerations about the quality of the signal stemming from different quarterly series (i.e. informative series should be duplicated more).  -->
<!--
Another possibility is to estimate different factor models for monthly and quarterly series, and combine them for the final prediction (e.g. by aggregating or blocking the monthly factor estimates). 

If performance is not critical, I also refer the user to the [*nowcasting*](<https://github.com/nmecsys/nowcasting>) and [*nowcastDFM*](<https://github.com/dhopp1/nowcastDFM>) packages, which provide elaborate models for mixed-frequency nowcasting, and handle mixed frequencies like BM14 (i.e. drawing on Mariano and Murasawa (2003)). -->
</div>
<div class="section level2">
<h2 id="additional-functions">Additional Functions<a class="anchor" aria-label="anchor" href="#additional-functions"></a>
</h2>
<p><em>dfms</em> also exports central functions that help with DFM
estimation, such as imputing missing values with
<code><a href="../reference/tsnarmimp.html">tsnarmimp()</a></code>, estimating a VAR with <code><a href="../reference/dot-VAR.html">.VAR()</a></code>, or
Kalman Filtering and Smoothing with <code><a href="../reference/SKFS.html">SKFS()</a></code>, or separately
with <code><a href="../reference/SKF.html">SKF()</a></code> followed by <code><a href="../reference/FIS.html">FIS()</a></code>. To my knowledge
these are the fastest routines for simple stationary Kalman Filtering
and Smoothing currently available in R. The function
<code><a href="../reference/em_converged.html">em_converged()</a></code> can be used to check convergence of the
log-likelihood in EM estimation.</p>
<p><em>dfms</em> also exports a matrix inverse and pseudo-inverse from
the Armadillo C++ library through the functions <code><a href="../reference/ainv.html">ainv()</a></code> and
<code><a href="../reference/ainv.html">apinv()</a></code>. These are often faster than <code><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve()</a></code>,
and somewhat more robust in near-singularity cases.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Doz, C., Giannone, D., &amp; Reichlin, L. (2011). A two-step
estimator for large approximate dynamic factor models based on Kalman
filtering. <em>Journal of Econometrics, 164</em>(1), 188-205.</p>
<p>Doz, C., Giannone, D., &amp; Reichlin, L. (2012). A quasi-maximum
likelihood approach for large, approximate dynamic factor models.
<em>Review of Economics and Statistics, 94</em>(4), 1014-1024.</p>
<p>Banbura, M., &amp; Modugno, M. (2014). Maximum likelihood estimation
of factor models on datasets with arbitrary pattern of missing data.
<em>Journal of Applied Econometrics, 29</em>(1), 133-160.</p>
<p>Mariano, R. S., &amp; Murasawa, Y. (2003). A new coincident index of
business cycles based on monthly and quarterly series. <em>Journal of
Applied Econometrics, 18</em>(4), 427-443.</p>
<p>Bai, J., Ng, S. (2002). Determining the Number of Factors in
Approximate Factor Models. <em>Econometrica, 70</em>(1), 191-221.</p>
<p>Onatski, A. (2010). Determining the number of factors from empirical
distribution of eigenvalues. <em>The Review of Economics and Statistics,
92</em>(4), 1004-1016.</p>
<p>Stock, J. H., &amp; Watson, M. W. (2016). Dynamic Factor Models,
Factor-Augmented Vector Autoregressions, and Structural Vector
Autoregressions in Macroeconomics. <em>Handbook of Macroeconomics,
2</em>, 415–525.</p>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>Banbura, M., &amp; Modugno, M. (2014). Maximum
likelihood estimation of factor models on datasets with arbitrary
pattern of missing data. <em>Journal of Applied Econometrics,
29</em>(1), 133-160.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Both about the monthly ones and quarterly series
contained in <code>BM14_Q</code>. The order of rows in
<code>BM14_Models</code> matches the column order of series in
<code>merge(BM14_M, BM14_Q)</code>.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>Data must be scaled and centered because the Kalman
Filter has no intercept term.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>Bai, J., Ng, S. (2002). Determining the Number of
Factors in Approximate Factor Models. <em>Econometrica, 70</em>(1),
191-221. <a href="doi:10.1111/1468-0262.00273" class="uri">doi:10.1111/1468-0262.00273</a><a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>Onatski, A. (2010). Determining the number of factors
from empirical distribution of eigenvalues. <em>The Review of Economics
and Statistics, 92</em>(4), 1004-1016.<a href="#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>Some authors like Doz, Giannone, and Reichlin (2012)
additionally allow the number of transition error processes, termed
‘dynamic factors’ and given an extra parameter <code>q</code>, to be
less than the number of ‘static factors’ <code>r</code>. I find this
terminology confusing and the feature not very useful for most practical
purposes, thus I have not implemented it in <em>dfms</em>.<a href="#fnref6" class="footnote-back">↩︎</a></p></li>
<li id="fn7"><p>Users can also choose from two different implementations
of the EM algorithm using the argument <code>em.method</code>. The
default is <code>em.method = "auto"</code>, which chooses the modified
EM algorithm proposed by BM14 for missing data if <code>anyNA(X)</code>,
and the plain EM implementation of Dos, Giannone and Reichlin (2012),
henceforth DGR12, otherwise. The baseline implementation of DGR12 is
typically more than 2x faster than BM14’s method, and can also be used
with data that has a few random missing values (&lt; 5%), but gives
wrong results with many and systematically missing data, such as ragged
edges at the beginning of end of the sample or series at different
frequencies. With complete datasets, both <code>em.method = "DGR"</code>
and <code>em.method = "BM"</code> gives identical factor estimates, and
in this case <code>em.method = "DGR"</code> should be used.<a href="#fnref7" class="footnote-back">↩︎</a></p></li>
<li id="fn8"><p>Doz, C., Giannone, D., &amp; Reichlin, L. (2011). A
two-step estimator for large approximate dynamic factor models based on
Kalman filtering. <em>Journal of Econometrics, 164</em>(1), 188-205.<a href="#fnref8" class="footnote-back">↩︎</a></p></li>
<li id="fn9"><p>Depending also on the lag-order of the factor-VAR.
Higher lag-orders product more interesting forecast dynamics.<a href="#fnref9" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Sebastian Krantz, Rytis Bagdziunas.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
